<!--
  ~ Copyright (c) 2014 The Finnish Board of Education - Opetushallitus
  ~
  ~ This program is free software:  Licensed under the EUPL, Version 1.1 or - as
  ~ soon as they will be approved by the European Commission - subsequent versions
  ~ of the EUPL (the "Licence");
  ~
  ~ You may not use this work except in compliance with the Licence.
  ~ You may obtain a copy of the Licence at: http://www.osor.eu/eupl/
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ European Union Public Licence for more details.
  -->

<div>
    <div class="row">
        <div class="span12">
            <h1 ng-bind="'template.header' | i18n"></h1>
        </div>
    </div>
    <div class="row margin-bottom-one">
        <div class="span12">
            <button auth="crudOph" class="btn btn-primary" ng-click="openCreateDialog()">
                <i class="icon-plus-sign margin-right-half"></i>
                <span>{{'common.btn.create.new' | i18n}}</span>
            </button>
        </div>
    </div>
    <div class="row margin-bottom-one">
        <div class="span12">
            <input-list label="{{'template.select' | i18n}}" items="letterTypes" model="radioSelection" input="radio"/>
        </div>
    </div>
    <div class="row">
        <div class="span12" ng-show="(radioSelection !== 'organization') && getTemplates()">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th></th>
                        <th class="span4" ng-bind="'common.header.lettertemplate' | i18n | uppercase"></th>
                        <th class="span2" ng-bind="'common.header.type' | i18n | uppercase"></th>
                        <th class="span2" ng-bind="'common.header.language' | i18n | uppercase"></th>
                        <th class="span2" ng-bind="'common.header.status' | i18n | uppercase"></th>
                        <th class="span2" ng-bind="'common.header.saved' | i18n | uppercase"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="letterTemplate in getTemplates()">
                        <td>
                            <div auth="crudOph" class="btn-group dropdown">
                                <input type="button" class="icon-actionmenu dropdown-toggle"/>
                                <ul class="dropdown-menu" role="menu">
                                	<li><button type="button" class="link-button" ng-click="viewTemplate(letterTemplate.id, letterTemplate.state)" ng-bind="'common.btn.show' | i18n"></button></li>
                                    <li><button type="button" class="link-button" ng-click="editTemplate(letterTemplate.id)" ng-disabled="letterTemplate.state !== 'luonnos'" ng-bind="'common.btn.edit' | i18n"></button></li>
                                    <li><button type="button" class="link-button" ng-click="publishTemplate(letterTemplate.id, letterTemplate.state)" ng-disabled="letterTemplate.state !== 'luonnos'" ng-bind="'common.btn.publish' | i18n"></button>
                                    <li><button type="button" class="link-button" ng-click="removeTemplate(letterTemplate.id, letterTemplate.state)" ng-disabled="letterTemplate.state === 'suljettu'" ng-bind="'common.btn.remove' | i18n"></button></li>
                                </ul>
                            </div>
                        </td>
                        <td>{{letterTemplate.name}}</td>
                        <td>{{translateTypes(letterTemplate.types).join(', ')}}</td>
                        <td>{{languages[letterTemplate.language]}}</td>
                        <td>{{letterStates[letterTemplate.state]}}</td>
                        <td>{{letterTemplate.timestamp | date:'d.M.yyyy H:mm'}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="span12" ng-show="(radioSelection === 'applicationTarget') && !getTemplates() && applicationTarget">
            <h5 class="center help-text-bold" ng-bind="'template.text.zero.templates' | i18n"></h5>
            <p class="center help-text margin-bottom-one" ng-bind="'template.text.add.new.template' | i18n"></p>
            <button class="center btn btn-primary" ng-click="openCreateDialog()" ng-bind="'common.btn.create.new' | i18n"><i class="icon-plus-sign margin-right-half"></i></button>
        </div>
        <!--<div ng-include="'views/letter-templates/views/partials/emptyListMessage.html'" ng-show="true"/>-->
        <div ng-controller="TemplateController" class="span12" ng-show="radioSelection === 'organization'">
            <div class="control-group">
                <select ng-model="selectedApplicationPeriod" ng-change="updateTreeData(selectedApplicationPeriod)" ng-options="Object.nimi.kieli_fi for Object in applicationPeriodList" class="selectpicker span6 placeholder">
                </select>
            </div>
            <tabset>
                <tab heading="Organisaation oletuskirjepohjat" select="templateTab()">
                    <div ng-include="'views/letter-templates/views/partials/emptyListMessage.html'" ng-show="template_tree_data[0].children.length < 1"/>
                    <span ng-show="template_tree_data[0].children.length > 0">
                        <tree-grid
                                tree-data       = "template_tree_data"
                                tree-control    = "template_tree_control"
                                col-defs        = "col_defs"
                                icon-leaf       = "icon-actionmenu"
                                icon-expand     = "icon-expand"
                                icon-collapse   = "icon-expanded"
                                on-select       = "my_tree_handler(branch, event)"
                                expand-level    = "5"
                                edit-template-handler="editTemplate(treeTemplate.id, treeTemplate.state)"
                                publish-template-handler="publishTemplate(treeTemplate.id, treeTemplate.state)"
                                remove-template-handler="removeTemplate(treeTemplate.id, treeTemplate.state)"
                                >
                        </tree-grid>
                    </span>
                </tab>
                <tab heading="Hakukohteiden kirjeluonnokset" select="draftTab()">
                    <div ng-include="'views/letter-templates/views/partials/emptyListMessage.html'" ng-show="draft_tree_data[0].children.length < 1"/>
                    <span ng-show="draft_tree_data[0].children.length > 0">
                        <tree-grid
                                tree-data       = "draft_tree_data"
                                tree-control    = "draft_tree_control"
                                col-defs        = "col_defs"
                                icon-leaf       = "icon-actionmenu"
                                icon-expand     = "icon-expand"
                                icon-collapse   = "icon-expanded"
                                on-select       = "my_tree_handler(branch, event)"
                                expand-level    = "5"
                                edit-template-handler="editDraft(treeTemplate)"
                                publish-template-handler="publishDraft(treeTemplate)"
                                remove-template-handler="deleteDraft(treeTemplate)"
                                >
                        </tree-grid>
                    </span>
                </tab>
            </tabset>
        </div>
    </div>
</div>