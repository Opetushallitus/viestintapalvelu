<div class="container">
  <div class="titlebar row-fluid">
    <h1>{{'reportedletterlist.otsikko.lahetysraportit' | i18n}}</h1>
  </div> 

  <div class="search-controls row-fluid">

    <div class="organisation-select form-inline span4">
      <label for="organisationSelect">{{'reportedletterlist.otsikko.organisaatio' | i18n}}</label>
      <select name="organisationSelect" 
              ng-model="form.organization" 
              ng-change="fetch()"
              ng-options="organization.name for organization in reportedLettersDTO.organizations track by organization.oid"
              ng-init="form.organization = reportedLettersDTO.organizations[reportedLettersDTO.selectedOrganization]"
              ng-if="reportedLettersDTO.organizations">
      </select>
    </div>

    <div class="search form-inline span8">
        <table>
            <tr>
                <td rowspan="2" style="vertical-align: top">
                    {{'reportedletterlist.searchTarget.label' | i18n}}
                </td>
                <td>
                    <input id="searchTargetBatch" type="radio" name="searchTarget" value="batch"
                           ng-model="searchTarget"/>
                </td>
                <td>
                    <label for="searchTargetBatch">{{'reportedletterlist.searchTarget.batch' | i18n}}</label>
                </td>
            </tr>
            <tr>
                <td>
                    <input id="searchTargetReceiver" type="radio" name="searchTarget" value="receiver"
                           ng-model="searchTarget"/>
                </td>
                <td>
                    <label for="searchTargetReceiver">{{'reportedletterlist.searchTarget.receiver' | i18n}}</label>
                </td>
            </tr>
        </table>
        <table><tr><td style="vertical-align: top;">
            <input type="checkbox" ng-model="includeOlder" id="includeOlder"/>
        </td><td>
            <label for="includeOlder">{{'reportedletterlist.includeOlder' | i18n}}</label>
        </td></tr></table>
        <input type="text" ng-model="searchArgument" ng-enter="search()"
               placeholder="{{'reportedletterlist.searchTarget.'+searchTarget+'.placeholder' | i18n}}"/>
        <button class="btn btn-primary" ng-click="search()" ng-disabled="!searchArgument">
            {{'reportedletterlist.button.hae' | i18n}}
        </button>
        <button class="btn" ng-click="emptySearch()">{{'reportedletterlist.button.tyhjenna' | i18n}}</button>
        <div style="color:gray; font-style: italic">
            {{'reportedletterlist.searchTarget.'+searchTarget+'.description' | i18n}}
        </div>
    </div>

  </div>

  <div class="row-fluid">
    <div class="span3">
    </div>
  </div>

  <div class="row-fluid" ng-if="reportedLettersDTO.letterBatchReports.length > 0">
    <div class="span3" ng-show="!reportedLettersDTO.maxNumber || reportedLettersDTO.numberOfLetterBatches < reportedLettersDTO.maxNumber">
      {{reportedLettersDTO.numberOfLetterBatches}} &nbsp {{'reportedletterlist.otsikko.raporttia' | i18n}}
    </div>
    <div class="span3" ng-show="reportedLettersDTO.maxNumber &amp;&amp; reportedLettersDTO.numberOfLetterBatches > reportedLettersDTO.maxNumber">
        {{'reportedletterlist.otsikko.enammankuin.alku' | i18n}} &nbsp; {{reportedLettersDTO.maxNumber}} &nbsp; {{'reportedletterlist.otsikko.enammankuin.loppu.'+doneSearchTarget | i18n}}
    </div>
  </div>

  <div class="reported-letters row-fluid">
    <table class="table table-striped clickable-table-row" ng-if="reportedLettersDTO.numberOfLetterBatches > 0">
      <thead>
        <tr>
          <th class="span1 clickable-header-cell" ng-click="sortBy('timestamp')" ng-class="getSortClass('timestamp')">{{ 'reportedletterlist.otsikko.ajankohta' | i18n | uppercase }}</th>
          <th ng-show="doneSearchTarget == 'receiver'" ng-click="sortBy('receiverName')" ng-class="getSortClass('receiverName')" class="span1 clickable-header-cell" >{{ 'reportedletterlist.otsikko.nimi' | i18n | uppercase }}</th>
          <th class="span1 clickable-header-cell" ng-click="sortBy('templateName')" ng-class="getSortClass('templateName')">{{ 'reportedletterlist.otsikko.kirjepohja' | i18n | uppercase }}</th>
          <th class="span2 clickable-header-cell" ng-click="sortBy('applicationPeriod')" ng-class="getSortClass('applicationPeriod')">{{ 'reportedletterlist.otsikko.haku' | i18n | uppercase }}</th>
          <th class="span3 clickable-header-cell" ng-click="sortBy('fetchTarget')" ng-class="getSortClass('fetchTarget')">{{ 'reportedletterlist.otsikko.hakukohde' | i18n | uppercase }}</th>
          <th class="span2">{{ 'reportedletterlist.otsikko.tila' | i18n | uppercase }}</th>
          <th class="span2 clickable-header-cell" ng-click="sortBy('tag')" ng-class="getSortClass('tag')">{{ 'reportedletterlist.otsikko.tunniste' | i18n | uppercase }}</th>
          <th ng-show="doneSearchTarget == 'receiver'" class="span2 header-cell">{{ 'reportedletterlist.otsikko.kirje' | i18n | uppercase }}</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="reportedLetter in reportedLettersDTO.letterBatchReports">
          <td ng-click="showReportedLetter(reportedLetter)">{{ reportedLetter.timestamp | date:'d.M.yyyy H:mm' }}</a></td>
          <td ng-click="showReportedLetter(reportedLetter)" ng-show="doneSearchTarget == 'receiver'">{{ reportedLetter.receiverName}}</td>
          <td ng-click="showReportedLetter(reportedLetter)">{{ reportedLetter.templateName }}</td>
          <td ng-click="showReportedLetter(reportedLetter)">{{ reportedLetter.applicationPeriod }}</td>
          <td ng-click="showReportedLetter(reportedLetter)">{{ reportedLetter.fetchTarget }}</td>
          <td ng-click="showReportedLetter(reportedLetter)">{{ reportedLetter.status }} <img ng-show="reportedLetter.status == 'error'" style="margin-right:10px;" src="./assets/img/error-icon28x29.png"></td>
          <td ng-click="showReportedLetter(reportedLetter)">{{ reportedLetter.tag }}</td>
          <td ng-show="doneSearchTarget == 'receiver'"><a ng-show="reportedLetter.status != 'error'" ng-click="downloadLetter(reportedLetter.receiverLetterId)">{{reportedLetter.templateName}}.pdf</a></td>
        </tr>
      </tbody>
    </table>

    <div class="alert alert-info" ng-if="reportedLettersDTO.numberOfLetterBatches === 0">{{'reportedletterlist.alert.eikirjelahetyksia' | i18n}}</div>
  </div>

  <div class="pagination pagination-centered row-fluid" ng-if="reportedLettersDTO.numberOfLetterBatches > pagination.pageSize">
    <pagination total-items="reportedLettersDTO.numberOfLetterBatches" 
                items-per-page="{{ pagination.pageSize }}"
                ng-model="pagination.page"
                ng-change="fetch()"
                previous-text="{{'pagination.button.edellinen' | i18n}}"
                next-text="{{'pagination.button.seuraava' | i18n}}"></pagination>
  </div>
</div>
